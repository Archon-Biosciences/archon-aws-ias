FROM public.ecr.aws/lambda/python:3.9

RUN yum update -y \
    && yum install wget unzip git -y \
    && yum clean all \
    && rm -rf /var/cache/yum

RUN python -m ensurepip --upgrade \
    && python -m pip install --upgrade --no-cache-dir \
      --extra-index-url https://download.pytorch.org/whl/cpu \
      --target "${LAMBDA_TASK_ROOT}" \
      torch numpy

RUN git clone --depth 1 https://github.com/dauparas/ProteinMPNN.git ${LAMBDA_TASK_ROOT}/ProteinMPNN
    
RUN wget -O "awscliv2.zip" "https://awscli.amazonaws.com/awscli-exe-linux-aarch64.zip" \
    && unzip awscliv2.zip \
    && ./aws/install \
    && rm awscliv2.zip

WORKDIR ${LAMBDA_TASK_ROOT}/ProteinMPNN

COPY run.sh run.sh

CMD [ "app.lambda_handler" ] 